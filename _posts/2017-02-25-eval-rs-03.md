---
layout: post
title:  "Parsing, or not"
date:   2017-02-25 12:22 EST5EDT
categories: eval-rs
comments: true
---

# ParseError

I have spent an inordinate amount of time this week reading the
[100 Cupboards](http://www.goodreads.com/book/show/1661390.100_Cupboards) series,
and not thinking about this project. The same author wrote
[Outlaws of Time](http://www.goodreads.com/book/show/25817037-the-legend-of-sam-miracle)
which I couldn't put down last year even though I was in bed with a fever at the time. N.D. Wilson is
the kind of writer who can paint a thousand pictures with every word, rendering an
action movie in real time in your imagination. Coincidentally, that book was inspired by a
dream while he himself was
[down with a fever](https://www.theatlantic.com/entertainment/archive/2016/04/why-i-write-scary-stories-for-children/478977/).

Anyway enough of distraction, I should put some thought into my own grammar!

Lisp is represented by [S-expressions](https://en.wikipedia.org/wiki/S-expression),
making it an easy grammar by any standards, certainly Mr Wilson's. I'm not dealing with
hash-map, string or numeric syntaxes yet either. All I have is lists of symbols.

Despite picking the easiest thing in the world to parse, it's been nearly half a lifetime
since I did this at university. This is going to take me a while to relearn. I'm definitely
going to feel not very smart for a while.

Things I have to consider:

* the empty list `()`, or `nil`
* dot notation: `(a . b)`
* list shorthand: `(a b c d e)`
* nestedness: `((a) b)` etc

## Internal representation

The data structure to represent these S-expressions isn't immediately obvious. In
the more Common Lisps, the empty list `()` is also represented by the symbol `nil`.
Does that mean empty list really is a symbol? Or is it a cons cell with both
values empty? Or both?

Thinking about it, it can only be one thing: a special symbol. Symbols and cons cells
are the only constructs available and if a cons cell has both values empty, then
what is the type of empty? Empty must be the `nil` symbol, alternatively written `()`.

Secondly, should I just use `Vec`s as lists or should I go
[down that road](http://cglab.ca/~abeinges/blah/too-many-lists/book/first-new.html),
using a `Pair` type to make a linked list? I'm inclined toward the latter, since
it's more historically accurate and I like history. And pain, apparently.

I don't really like pain and making a linked list structure in Rust does seem
inadvisable. It would also probably mean `Rc<Pair>` being a pervasive type throughout
my project, which I'm not excited about. It's not the memory managment model I'm
interested in exploring further down the road.

What this is beginning to look like is that I'm not ready to parse.

Should have seen this coming. I've spent a couple years daydreaming about creating a
programming language and have always come back to the notion that memory management
is so fundamental that it must be the starting point. I'm going to have to switch tracks.

There are so many options available and none, with the exception of `Rc`, are going
to be easy. I don't want to use `Rc`.

I just happen to have a copy of [The Garbage Collection Handbook](http://gchandbook.org/)
and I will now spend some time in it's pages.

Back soon...
